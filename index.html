<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <title>CRUD-Anwendung Mitarbeiter</title>
    <!--
    Ziel ist eine CRUD-Anwendung, in der Mitarbeiter
    - erstellt
    - angezeigt
    - geändert und
    - gelöscht werden können

    Aufgabe 1: erstelle ein javascript, dass bei Knopfdruck auf "Hinzufügen":
    - überprüft, dass beide input-Felder nicht leer sind
    - eine neue id erstellt (es soll fortlaufend hochgezählt werden)
    - die id, den Vornamen, den Nachnamen und den Monatslohn in der Tabelle ergänzt
    - die input-Felder für die nächste Eingabe leert

    - dabei soll ein Array aus Mitarbeiter-Objekten erstellt werden,
    - welches alle aktuellen Mitarbeiter enthält
    -->
    <style>
        .headers {
            font-weight: bold;
        }
    </style>
</head>
<body>
<h2>Mitarbeiter</h2>
<div>
    <label for="firstNameInput">Vorname: </label><input type="text" id="firstNameInput">
    <label for="lastNameInput">Nachname: </label><input type="text" id="lastNameInput">
    <label for="monSalInput">Monatslohn: </label><input type="text" id="monSalInput">
    <button type="button" id="addButton">Hinzufügen</button>
</div>
<br>
<div id="ausgabe"></div>
<script>
    class Employee {
        static employeeNextId = 1;

        constructor(first, last, salary) {
            this.id = Employee.employeeNextId;
            this.setFirstName(first);
            this.setLastName(last);
            this.monSal = salary;
            Employee.employeeNextId++;
        }

        getFirstName() {
            return this.firstName;
        }

        getlastName() {
            return this.lastName;
        }

        getMonSal() {
            return this.monSal;
        }

        setFirstName(newFirstName) {
            if (newFirstName !== ""){
                this.firstName = newFirstName.trim();
            }
        }

        setLastName(newLastName) {
            if (newLastName !== ""){
                this.lastName = newLastName.trim();
            }
        }

        setMonSal(newMonSal) {
            if (newMonSal !== ""){
                this.monSal = newMonSal.trim();
            }
        }

    }
    // class method zum pushen eines neu erstellten Employee objekts
    Employee.add = function (obj) {
        empArray.push(obj);
    }

    // array erstellen für alle Employee-objekte
    let empArray = [];

    // beispieldaten erzeugen und zum array hinzufügen
    const emp001 = new Employee("Petra", "Pan", 2100);
    const emp002 = new Employee("Freya", "Ridings", 2450.30);
    empArray = [emp001, emp002];

    // funktion, die überprüft, ob ein übergebenes feld leer ist
    function isNotEmpty(field) {
        if (field.toString().trim() === "") {
            return false;
        }
        else {
            return true;
        }
    }


    // funktion zum erzeugen von Employee objekten
    function createEmployee() {
        let first = document.getElementById("firstNameInput").value.trim();
        let last = document.getElementById("lastNameInput").value.trim();
        let monSal = document.getElementById("monSalInput").value.trim();
        // unsere 3 felder werden auf leerheit überprüft
        if (isNotEmpty(first) && isNotEmpty(last) && isNotEmpty(monSal)) {
            // wenn sie nicht leer sind, wird ein neues Employee objekt erstellt
            const newEmp = new Employee(first, last, Number(monSal));
            // und mit der add methode ins array gepusht
            Employee.add(newEmp);
            console.log(empArray);
            document.getElementById("ausgabe").innerHTML = "";
            drawTable();
            return newEmp;
        }
        else {
            // ansonsten gibts nen fehler
            alert("Alle Felder müssen ausgefüllt sein.");
        }
    }

    // eventlistener für den button
    document.getElementById("addButton").addEventListener("click", createEmployee);
    document.getElementById("addButton").addEventListener("click", addRow);


    console.log(empArray);

    // überschriften für die tabelle
    let headers = ["ID", "Vorname", "Nachname", "Monatslohn"];

    // funktion zum erzeugen der tabelle
    function drawTable() {
        let tabelle = document.createElement("table");
        document.getElementById("ausgabe").appendChild(tabelle);
        let head = document.createElement("thead");
        let body = document.createElement("tbody");
        tabelle.appendChild(head);
        tabelle.appendChild(body);
        head.appendChild(document.createElement("tr"));

        // hier wird die header row ausgefüllt
        for (let i = 0; i < headers.length; i++) {
            let td = document.createElement("td");
            td.className = "headers";
            let node = document.createTextNode(headers[i]);
            td.appendChild(node);
            document.getElementsByTagName("tr")[0].appendChild(td);
        }

        // Befüllen des table bodys mit den property values aller Mitarbeiter-objekte
        for (let i = 0; i < empArray.length; i++) {                               // Für jeden Teilnehmer
            let row = document.createElement("tr");                               // erzeuge eine tr
            for (const attribut in empArray[i]) {                                 // für jedes attribut im objekt
                let td = document.createElement("td");                            // erzeuge eine td
                let node = document.createTextNode(empArray[i][attribut]);        // erzeuge eine textnode mit dem attribut value
                td.appendChild(node);                                             // hänge node an td
                row.appendChild(td);                                              // hänge td an die tr
            }
            createDeleteButton(row, empArray[i]["id"]);
            createUpdateButton(row, empArray[i]["id"]);
            document.getElementsByTagName("tbody")[0].appendChild(row);           // hänge tr an den table body
        }
    }

    // td mit button wird erstellt, button kriegt event listener und die id seines zugehörigen objekts
    function createDeleteButton(row, id) {
        let td = document.createElement("td");
        let deleteButton = document.createElement("button");
        deleteButton.setAttribute("type", "button");
        deleteButton.className = "delButtons";
        deleteButton.setAttribute("id", id);
        deleteButton.innerHTML = "Löschen";
        deleteButton.addEventListener("click", function () {
            deleteEmployee(empArray, this.id)});
        td.appendChild(deleteButton);
        row.appendChild(td);
    }


    // loopt durch das array und wenn die property id eines  objekts === die übergebene id vom button, dann löscht es diesen
    // eintrag aus dem  array, löscht den inhalt des ausgabe-divs und schreibt die tabelle neu rein
    function deleteEmployee(array, index) {
        for (let i = 0; i < array.length; i++) {
            if (array[i].id.toString() === index) {
                array.splice(i, 1);
            }
        }
        document.getElementById("ausgabe").innerHTML = "";
        drawTable();
    }

    function createUpdateButton(row, id) {
        let td = document.createElement("td");
        let deleteButton = document.createElement("button");
        deleteButton.setAttribute("type", "button");
        deleteButton.className = "updButtons";
        deleteButton.setAttribute("id", id);
        deleteButton.innerHTML = "Ändern";
        deleteButton.addEventListener("click", function () {
            updateEmployee(empArray, this.id)});
        td.appendChild(deleteButton);
        row.appendChild(td);
    }

    function updateEmployee(array, index) {
        for (let i = 0; i < array.length; i++) {
            if (array[i].id.toString() === index) {
                array[i].setFirstName(document.getElementById("firstNameInput").value);
                array[i].setLastName(document.getElementById("lastNameInput").value);
                array[i].setMonSal(document.getElementById("monSalInput").value);
                console.log(empArray);
            }
        }
        resetInput(document.getElementById("firstNameInput"));
        resetInput(document.getElementById("lastNameInput"));
        resetInput(document.getElementById("monSalInput"));
        document.getElementById("ausgabe").innerHTML = "";
        drawTable();
    }


    // funktion zum hinzufügen einer reihe
    function addRow() {
        let first = document.getElementById("firstNameInput").value;
        let last = document.getElementById("lastNameInput").value;
        let monSal = document.getElementById("monSalInput").value;
        if (isNotEmpty(first) && isNotEmpty(last) && isNotEmpty(monSal)) {
            let row = document.createElement("tr");
            // alle property values des letzten objekts im array werden in tds appended
            for (const attribut in empArray[empArray.length - 1]) {
                let td = document.createElement("td");
                let node = document.createTextNode(empArray[empArray.length - 1][attribut]);
                td.appendChild(node);
                row.appendChild(td);
            }
            createDeleteButton(row, empArray[empArray.length - 1]["id"]);
            createUpdateButton(row, empArray[empArray.length - 1]["id"]);
            document.getElementsByTagName("tbody")[0].appendChild(row);
            // alles fertig, jetzt werden die input felder gelöscht
            resetInput(document.getElementById("firstNameInput"));
            resetInput(document.getElementById("lastNameInput"));
            resetInput(document.getElementById("monSalInput"));
            document.getElementById("ausgabe").innerHTML = "";
            drawTable();
        }
    }

    // löschen der input felder
    function resetInput(field) {
        field.value = "";
    }

    drawTable();

</script>
</body>
</html>