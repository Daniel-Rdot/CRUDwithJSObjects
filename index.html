<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <title>CRUD-Anwendung Mitarbeiter</title>
    <!--
    Ziel ist eine CRUD-Anwendung, in der Mitarbeiter
    - erstellt
    - angezeigt
    - geändert und
    - gelöscht werden können

    Aufgabe 1: erstelle ein javascript, dass bei Knopfdruck auf "Hinzufügen":
    - überprüft, dass beide input-Felder nicht leer sind
    - eine neue id erstellt (es soll fortlaufend hochgezählt werden)
    - die id, den Vornamen, den Nachnamen und den Monatslohn in der Tabelle ergänzt
    - die input-Felder für die nächste Eingabe leert

    - dabei soll ein Array aus Mitarbeiter-Objekten erstellt werden,
    - welches alle aktuellen Mitarbeiter enthält
    -->
    <style>
        .headers {
            font-weight: bold;
        }
    </style>
</head>
<body>
<h2>Mitarbeiter</h2>
<div>
    <label for="firstName">Vorname: </label><input type="text" id="firstName">
    <label for="lastName">Nachname: </label><input type="text" id="lastName">
    <label for="monSal">Monatslohn: </label><input type="text" id="monSal">
    <button type="button" id="addButton">Hinzufügen</button>
</div>
<br>
<div id="ausgabe"></div>
<script>
    class Employee {
        static employeeNextId = 1;

        constructor(first, last, salary) {
            this.id = Employee.employeeNextId;
            this.firstName = first;
            this.lastName = last;
            this.monSal = salary;
            Employee.employeeNextId++;
        }
    }
    // class method zum pushen eines neu erstellten Employee objekts
    Employee.add = function (obj) {
        empArray.push(obj);
    }

    // array erstellen für alle Employee-objekte
    let empArray = [];

    // beispieldaten erzeugen und zum array hinzufügen
    const emp001 = new Employee("Petra", "Pan", 2100);
    const emp002 = new Employee("Freya", "Ridings", 2450.30);
    empArray = [emp001, emp002];

    // funktion, die überprüft, ob ein übergebenes feld leer ist
    function isNotEmpty(field) {
        if (field.toString().trim() === "") {
            return false;
        }
        else {
            return true;
        }
    }


    // funktion zum erzeugen von Employee objekten
    function createEmployee() {
        let first = document.getElementById("firstName").value.trim();
        let last = document.getElementById("lastName").value.trim();
        let monSal = document.getElementById("monSal").value.trim();
        // unsere 3 felder werden auf leerheit überprüft
        if (isNotEmpty(first) && isNotEmpty(last) && isNotEmpty(monSal)) {
            // wenn sie nicht leer sind, wird ein neues Employee objekt erstellt
            const newEmp = new Employee(first, last, Number(monSal));
            // und mit der add methode ins array gepusht
            Employee.add(newEmp);
            return newEmp;
        }
        else {
            // ansonsten gibts nen fehler
            alert("Alle Felder müssen ausgefüllt sein.");
        }
    }

    // eventlistener für den button
    document.getElementById("addButton").addEventListener("click", createEmployee);
    document.getElementById("addButton").addEventListener("click", addRow);


    console.log(empArray);

    // überschriften für die tabelle
    let headers = ["ID", "Vorname", "Nachname", "Monatslohn"];

    // funktion zum erzeugen der tabelle
    function drawTable() {
        let tabelle = document.createElement("table");
        document.getElementById("ausgabe").appendChild(tabelle);
        let head = document.createElement("thead");
        let body = document.createElement("tbody");
        tabelle.appendChild(head);
        tabelle.appendChild(body);
        head.appendChild(document.createElement("tr"));

        // hier wird die header row ausgefüllt
        for (let i = 0; i < headers.length; i++) {
            let td = document.createElement("td");
            td.className = "headers";
            let node = document.createTextNode(headers[i]);
            td.appendChild(node);
            document.getElementsByTagName("tr")[0].appendChild(td);
        }

        // Befüllen des table bodys mit den property values aller Mitarbeiter-objekte
        for (let i = 0; i < empArray.length; i++) {                               // Für jeden Teilnehmer
            let row = document.createElement("tr");                               // erzeuge eine tr
            for (const attribut in empArray[i]) {                                 // für jedes attribut im objekt
                let td = document.createElement("td");                            // erzeuge eine td
                let node = document.createTextNode(empArray[i][attribut]);        // erzeuge eine textnode mit dem attribut value
                td.appendChild(node);                                             // hänge node an td
                row.appendChild(td);                                              // hänge td an die tr
            }
            document.getElementsByTagName("tbody")[0].appendChild(row);           // hänge tr an den table body
        }
    }

    // funktion zum hinzufügen einer reihe
    function addRow() {
        let first = document.getElementById("firstName").value;
        let last = document.getElementById("lastName").value;
        let monSal = document.getElementById("monSal").value;
        if (isNotEmpty(first) && isNotEmpty(last) && isNotEmpty(monSal)) {
            let row = document.createElement("tr");
            // alle property values des letzten objekts im array werden in tds appended
            for (const attribut in empArray[empArray.length - 1]) {
                let td = document.createElement("td");
                let node = document.createTextNode(empArray[empArray.length - 1][attribut]);
                td.appendChild(node);
                row.appendChild(td);
            }
            document.getElementsByTagName("tbody")[0].appendChild(row);
            // alles fertig, jetzt werden die input felder gelöscht
            resetInput(document.getElementById("firstName"));
            resetInput(document.getElementById("lastName"));
            resetInput(document.getElementById("monSal"));
        }
    }

    // löschen der input felder
    function resetInput(field) {
        field.value = "";
        // return field;
    }

    drawTable();

</script>
</body>
</html>